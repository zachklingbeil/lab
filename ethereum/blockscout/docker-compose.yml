services:
    backend:
        image: ghcr.io/blockscout/blockscout
        container_name: backend
        pull_policy: always
        restart: always
        stop_grace_period: 5m
        command: sh -c "bin/blockscout eval \"Elixir.Explorer.ReleaseTasks.create_and_migrate()\" && bin/blockscout start"
        environment:
            - ETHEREUM_JSONRPC_VARIANT=geth
            - ETHEREUM_JSONRPC_TRANSPORT=ipc
            - IPC_PATH=/.ethereum/geth.ipc
            - DATABASE_URL=postgresql://postgres:${PASSWORD}@postgres:5432/blockscout?ssl=false
            - USER_OPS_INDEXER__DATABASE__CONNECT__URL=postgresql://postgres:${PASSWORD}@postgres:5432/blockscout?ssl=false
            - REDIS_URL=redis://redis:6379/1
            - ECTO_USE_SSL=false
            - CHAIN_ID=1
            - CHAIN_TYPE=ethereum
            - NETWORK=ethereum
            - COIN=ETH
            - DISABLE_WEBAPP=true
            - DISABLE_MARKET=true
            - INDEXER_DISABLE_PENDING_TRANSACTIONS_FETCHER=true
            - PORT=4000
            - ACCOUNT_ENABLED=false
            - API_GRAPHQL_ENABLED=false
            - MICROSERVICE_ACCOUNT_ABSTRACTION_ENABLED=true
            - MICROSERVICE_ACCOUNT_ABSTRACTION_URL=http://user-ops-indexer:8050/
            - MICROSERVICE_SIG_PROVIDER_ENABLED=true
            - MICROSERVICE_SIG_PROVIDER_URL=http://sig-provider:8050/
            - MICROSERVICE_SC_VERIFIER_ENABLED=true
            - MICROSERVICE_SC_VERIFIER_URL=http://smart-contract-verifier:8050/
            - MICROSERVICE_SC_VERIFIER_TYPE=eth_bytecode_db
            - MICROSERVICE_SC_VERIFIER_TYPE=sc_verifier
            - TXS_STATS_DAYS_TO_COMPILE_AT_INIT=0
            - COIN_BALANCE_HISTORY_DAYS=0
            - RE_CAPTCHA_DISABLED=false
            - MICROSERVICE_VISUALIZE_SOL2UML_ENABLED=false
            - DECODE_NOT_A_CONTRACT_CALLS=true
            - API_V2_ENABLED=true
            - API_V1_READ_METHODS_DISABLED=false
            - API_V1_WRITE_METHODS_DISABLED=false
            - NFT_MEDIA_HANDLER_ENABLED=true
            - ADMIN_PANEL_ENABLED=false
        networks:
            - timefactory
        expose:
            - 4000
        volumes:
            - blockscout:/app/logs/
            - blockscout:/app/dets/
            - geth:/.ethereum

networks:
    timefactory:
        external: true
volumes:
    blockscout:
        external: true
    geth:
        external: true
